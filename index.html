<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>SUPERHERO 신규 상장 코인 리스트 (3~6개월 이내)</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background-color: black;
      color: white;
      font-family: "Noto Sans KR", sans-serif;
      width: 100vw;
      height: 100vh;
      overflow-x: hidden;
    }
    body {
      transform: scale(0.8);
      transform-origin: top left;
      width: 125%;
      height: 125%;
      padding: 40px;
    }
    h1 {
      font-size: 26px;
      font-weight: bold;
      margin-bottom: 10px;
      color: white;
    }
    #time { margin-bottom: 20px; font-size: 16px; color: #cccccc; }
    #countdown { margin-left: 20px; color: #888; }

    /* 리스트: 2~N열 자동 + 오른쪽 여백 확보 */
    ul#coin-list {
      list-style: none;
      padding: 0;
      margin-top: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
      gap: 10px 20px;
      padding-right: 60px;  /* 오른쪽에 공백 추가 */
      box-sizing: border-box;
    }

    li.coin-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #1b1b1b;   /* 밝게 */
      padding: 10px 16px;
      border-radius: 8px;
      transition: all 0.25s ease;
      box-shadow: 0 0 6px rgba(255, 255, 255, 0.05);
    }
    li.coin-item:hover {
      background: #2a2a2a;
      transform: translateY(-2px);
      box-shadow: 0 0 10px rgba(0, 255, 136, 0.15);
    }

    /* 글씨 10% 축소 + 흰색 */
    .symbol {
      font-weight: bold;
      font-size: 16px;
      color: white;
      cursor: pointer;
      white-space: nowrap;
    }
    .meta {
      color: #ccc;
      font-size: 14px;
      margin-left: 8px;
      white-space: nowrap;
    }
    /* ✅ 숫자만 살짝 더 크고 흰색으로 강조 */
    .meta .num {
      color: #fff;
      font-size: 15px;       /* 주변 13px 대비 약 +2px */
      font-weight: 700;
    }
  </style>
</head>
<body>
  <h1>■ SUPERHERO 신규 상장 코인 리스트 (3~6개월 이내) ■</h1>
  <div id="time">
    UTC 시간 로딩 중... <span id="countdown">다음 갱신까지 60s</span>
  </div>
  <ul id="coin-list"></ul>

  <script>
    const API_URL = "https://binance-flask-app-production.up.railway.app/recent_3to6m";
    let secondsToNextUpdate = 60;

    function updateTimeLabel() {
      const now = new Date();
      const y = now.getUTCFullYear();
      const m = String(now.getUTCMonth() + 1).padStart(2, '0');
      const d = String(now.getUTCDate()).padStart(2, '0');
      const h = String(now.getUTCHours()).padStart(2, '0');
      const mm = String(now.getUTCMinutes()).padStart(2, '0');
      document.getElementById("time").childNodes[0].textContent = `${y}-${m}-${d} ${h}:${mm} UTC`;
    }

    function startCountdown() {
      setInterval(() => {
        secondsToNextUpdate--;
        if (secondsToNextUpdate <= 0) secondsToNextUpdate = 60;
        document.getElementById("countdown").textContent = `다음 갱신까지 ${secondsToNextUpdate}s`;
      }, 1000);
    }

    async function fetchData() {
      try {
        const res = await fetch(API_URL);
        return await res.json();
      } catch (e) {
        console.error("API fetch error:", e);
        return [];
      }
    }

    function fmtRange(x) {
      if (x === undefined || x === null || isNaN(x)) return "-";
      return (Math.abs(x - Math.round(x)) < 0.05 ? Math.round(x) : x.toFixed(1)) + "%";
    }

    function renderList(data) {
      const list = d3.select("#coin-list");
      list.selectAll("li").remove();

      const items = list.selectAll("li.coin-item")
        .data(data)
        .enter()
        .append("li")
        .attr("class", "coin-item");

      // 번호 + 코인명 (클릭 시 바이낸스 선물 링크)
      items.append("span")
        .attr("class", "symbol")
        .text((d, i) => `${i + 1}. ${d.symbol}`)
        .on("click", (event, d) => {
          const url = `https://www.binance.com/en/futures/${d.symbol}`;
          window.open(url, "_blank");
        });

      // Max변동폭 + 상장 후 경과일 (숫자 강조)
      items.append("span")
        .attr("class", "meta")
        .html(d => {
          const range = fmtRange(d.max_range_pct).replace(/([\d.]+)%/, '<span class="num">$1</span>%');
          const days  = String(d.days).replace(/(\d+)/, '<span class="num">$1</span>');
          return `Max변동폭: ${range} · 상장 후 약 ${days}일`;
        });
    }

    async function updateList() {
      updateTimeLabel();
      secondsToNextUpdate = 60;
      const data = await fetchData();
      if (!data || data.length === 0) return;

      // 상장부터의 기간순(일봉 적은 순) 정렬
      const sorted = data.slice().sort((a, b) => a.days - b.days);
      renderList(sorted);
    }

    updateList();
    setInterval(updateList, 60 * 1000);
    startCountdown();
  </script>
</body>
</html>
