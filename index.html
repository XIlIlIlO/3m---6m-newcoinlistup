<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>SUPERHERO ì‹ ê·œ ìƒì¥ ì½”ì¸ ë¦¬ìŠ¤íŠ¸ (3~6ê°œì›” ì´ë‚´)</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    :root { --scale: 0.65; } /* 0.7, 0.8, 0.9 ... ì›í•˜ëŠ” ë°°ìœ¨ */
    html, body {
      margin: 0;
      padding: 0;
      background-color: black;
      color: white;
      font-family: "Noto Sans KR", sans-serif;
      width: 100vw;
      height: 100vh;
      overflow-x: hidden;
    }
    
    
    body {
      transform: scale(var(--scale));
      transform-origin: top left;
      width: calc(100% / var(--scale));   /* â† ì—­ë³´ì •: 0.7ì´ë©´ 142.857% */
      height: calc(100% / var(--scale));  /* â† ì—­ë³´ì • */
      padding: calc(40px / var(--scale)); /* â† ì‹œê°ì  íŒ¨ë”© ìœ ì§€ (0.7ì´ë©´ ì•½ 57px) */
    }
    h1 {
      font-size: 26px;
      font-weight: bold;
      margin-bottom: 10px;
      color: white;
    }
    #time { margin-bottom: 20px; font-size: 16px; color: #cccccc; }
    #countdown { margin-left: 20px; color: #888; }

    /* ë¦¬ìŠ¤íŠ¸: 2~Nì—´ ìë™ + ì˜¤ë¥¸ìª½ ì—¬ë°± í™•ë³´ */
    ul#coin-list {
      list-style: none;
      padding: 0;
      margin-top: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
      gap: 10px 20px;
      padding-right: 60px;   /* ì˜¤ë¥¸ìª½ ì—¬ë°± */
      box-sizing: border-box;
    }

    /* ì¹´ë“œ + ë„¤ì˜¨ ê·¸ë¦° (#afff00) */
li.coin-item {
  position: relative;
  background: #1b1b1b;
  padding: 10px 16px;
  border-radius: 8px;
  transition: all 0.25s ease;
  border: 1px solid rgba(175, 255, 0, 0.12); /* ğŸ’š ë„¤ì˜¨ ê·¸ë¦° í…Œë‘ë¦¬ */
  box-shadow: 0 0 6px rgba(175, 255, 0, 0.05);
  display: flex;
  justify-content: flex-start;  /* â† ì¢Œì¸¡ ì •ë ¬ ê³ ì • */
  align-items: center;
}

li.coin-item::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  box-shadow:
    0 0 10px rgba(175, 255, 0, 0.25),
    0 0 25px rgba(175, 255, 0, 0.15),
    0 0 50px rgba(175, 255, 0, 0.08); /* ğŸ’š ë„¤ì˜¨ ê·¸ë¦° ê¸€ë¡œìš° */
  opacity: 0;
  transition: opacity 0.25s ease;
}

li.coin-item:hover {
  background: #232323;
  transform: translateY(-2px);
  border-color: rgba(175, 255, 0, 0.4); /* ğŸ’š ê°•ì¡° ë„¤ì˜¨ ê·¸ë¦° */
}

li.coin-item:hover::after {
  opacity: 1; /* hover ì‹œ ë„¤ì˜¨ ê·¸ë¦° ê¸€ë¡œìš° í™œì„±í™” */
}
    /* í…ìŠ¤íŠ¸ */
    .symbol {
      font-weight: bold;
      font-size: 16px;
      color: white;
      cursor: pointer;
      white-space: nowrap;
      margin-right: 12px;                       /* ì¢Œ/ìš° ê°„ê²© */
    }
    .meta {
      margin-left: auto;                        /* â† í•­ìƒ ìš°ì¸¡ ëìœ¼ë¡œ */
      text-align: right;                        /* â† ë‚´ë¶€ ìš°ì¸¡ ì •ë ¬ */
      color: #ccc;
      font-size: 14px;
      white-space: nowrap;
    }
    .meta .num {
      color: #fff;
      font-size: 15px;                          /* ì£¼ë³€ ëŒ€ë¹„ ì‚´ì§ í¬ê²Œ */
      font-weight: 700;
    }
  </style>
</head>
<body>
  <h1>â–  SUPERHERO ì‹ ê·œ ìƒì¥ ì½”ì¸ ë¦¬ìŠ¤íŠ¸ (3~6ê°œì›” ì´ë‚´) â– </h1>
  <div id="time">
    UTC ì‹œê°„ ë¡œë”© ì¤‘... <span id="countdown">ë‹¤ìŒ ê°±ì‹ ê¹Œì§€ 60s</span>
  </div>
  <ul id="coin-list"></ul>

  <script>
    const API_URL = "https://binance-flask-app-production.up.railway.app/recent_3to6m";
    let secondsToNextUpdate = 60;

    function updateTimeLabel() {
      const now = new Date();
      const y = now.getUTCFullYear();
      const m = String(now.getUTCMonth() + 1).padStart(2, '0');
      const d = String(now.getUTCDate()).padStart(2, '0');
      const h = String(now.getUTCHours()).padStart(2, '0');
      const mm = String(now.getUTCMinutes()).padStart(2, '0');
      document.getElementById("time").childNodes[0].textContent = `${y}-${m}-${d} ${h}:${mm} UTC`;
    }

    function startCountdown() {
      setInterval(() => {
        secondsToNextUpdate--;
        if (secondsToNextUpdate <= 0) secondsToNextUpdate = 60;
        document.getElementById("countdown").textContent = `ë‹¤ìŒ ê°±ì‹ ê¹Œì§€ ${secondsToNextUpdate}s`;
      }, 1000);
    }

    async function fetchData() {
      try {
        const res = await fetch(API_URL);
        return await res.json();
      } catch (e) {
        console.error("API fetch error:", e);
        return [];
      }
    }

    function fmtRange(x) {
      if (x === undefined || x === null || isNaN(x)) return "-";
      return (Math.abs(x - Math.round(x)) < 0.05 ? Math.round(x) : x.toFixed(1)) + "%";
    }

    function renderList(data) {
      const list = d3.select("#coin-list");
      list.selectAll("li").remove();

      const items = list.selectAll("li.coin-item")
        .data(data)
        .enter()
        .append("li")
        .attr("class", "coin-item");

      // ë²ˆí˜¸ + ì½”ì¸ëª… (í´ë¦­ ì‹œ ë°”ì´ë‚¸ìŠ¤ ì„ ë¬¼)
      items.append("span")
        .attr("class", "symbol")
        .text((d, i) => `${i + 1}. ${d.symbol}`)
        .on("click", (event, d) => {
          const url = `https://www.binance.com/en/futures/${d.symbol}`;
          window.open(url, "_blank");
        });

      // Maxë³€ë™í­ + ìƒì¥ ê²½ê³¼ì¼ (ìˆ«ì ê°•ì¡°)
      items.append("span")
        .attr("class", "meta")
        .html(d => {
          const range = fmtRange(d.max_range_pct).replace(/([\d.]+)%/, '<span class="num">$1</span>%');
          const days  = String(d.days).replace(/(\d+)/, '<span class="num">$1</span>');
          return `Maxë³€ë™í­: ${range} Â· ìƒì¥ í›„ ì•½ ${days}ì¼`;
        });
    }

    async function updateList() {
      updateTimeLabel();
      secondsToNextUpdate = 60;
      const data = await fetchData();
      if (!data || data.length === 0) return;

      // ìƒì¥ë¶€í„°ì˜ ê¸°ê°„ìˆœ(ì¼ë´‰ ì ì€ ìˆœ)
      const sorted = data.slice().sort((a, b) => a.days - b.days);
      renderList(sorted);
    }

    updateList();
    setInterval(updateList, 60 * 1000);
    startCountdown();
  </script>
</body>
</html>

